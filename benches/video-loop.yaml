networks:
  video-loop:

services:
  media-gateway-server:
    image: media-gateway-server:latest
    networks:
      video-loop:
        aliases:
          - media-gateway-server
    ports:
      - 8080:8080
    volumes:
      - /tmp:/tmp

  media-gateway-client:
    image: media-gateway-client:latest
    networks:
      video-loop:
        aliases:
          - media-gateway-client
    depends_on:
      - media-gateway-server
    environment:
      - GATEWAY_URL=http://media-gateway-server:8080
    volumes:
      - /tmp:/tmp

  source:
    image: ghcr.io/insight-platform/savant-adapters-gstreamer:latest
    entrypoint: /opt/savant/adapters/gst/sources/video_loop.sh
    networks:
      video-loop:
        aliases:
          - source
    depends_on:
      - media-gateway-client
    environment:
      - ZMQ_ENDPOINT=pub+connect:ipc:///tmp/client
      - LOCATION=/data/file_example_MP4_1280_10MG.mp4
      - SOURCE_ID=video-loop-benchmark
      - DOWNLOAD_PATH=/tmp/download
    volumes:
      - /tmp:/tmp
      - ./assets/file_example_MP4_1280_10MG.mp4:/data/file_example_MP4_1280_10MG.mp4
